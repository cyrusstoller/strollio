<h3>You searched for "<%= params[:q] %>"</h3>

<% if @query["ResultSet"]["Result"].kind_of?(Array) %>
  <h4>Uh oh. That's not specific enough. Which location did you mean to search for?</h4>
  <br>
  <ul>
    <% @query["ResultSet"]["Result"].each do |addr| %>
      <li>
        <% loc = [addr["city"], addr["county"], addr["state"], addr["country"]].compact.join(", ") %>
        <%= link_to loc, pictures_path(:q => loc) %>
      </li>
    <% end %>
  </ul>
<% else %>
  <h4>
    We searched around
    <% addr = @query["ResultSet"]["Result"] %> 
    "<%= [addr["city"], addr["county"], addr["state"], addr["country"]].compact.join(", ") %>"
  </h4>
<% end %>
<br>
<button id="toggle-fullscreen" class="btn btn-large btn-primary" data-toggle="button">Toggle Fullscreen</button>


<hr>

<!--STATIC IMAGE GALLERY -->

<div class="row">
  <div class="span9">
    <div id="gallery" data-toggle="modal-gallery" data-target="#modal-gallery">
      <% if @pictures %>      
        <% @pictures.each do |p| %>
          <% caption = p["data"]["caption"] %>
          <% if caption %>
            <% title = [] %>
            <% title << (caption["from"]["username"]).html_safe rescue nil %>
            <% title << caption["text"] rescue nil %>
            <% title = title.join(" &mdash; ").html_safe %>
          <% else %>
            <% title = "" %>
          <% end %>
        
          <%= link_to p["oembed"]["url"], :title => title, :rel => "gallery" do %>
            <%= image_tag p["oembed"]["url"] %>
          <% end %>
        <% end %>
      <% end %>
      
      <% if @additional_pictures %>
        <% @additional_pictures.each do |p| %>
          <% caption = p["caption"] %>
          <% if caption %>
            <% title = [] %>
            <% title << (caption["from"]["username"]).html_safe rescue nil %>
            <% title << caption["text"] rescue nil %>
            <% title = title.join(" &mdash; ").html_safe %>
          <% end %>
          
          <%= link_to p["images"]["standard_resolution"]["url"], :title => title, :rel => "gallery" do %>
            <%= image_tag p["images"]["standard_resolution"]["url"] %><br>
          <% end %>
          
        <% end %>
      <% end %>
    </div>
  </div>
  <div class="span3">
    <% if @lat and @lon %>
      <h4>Nearest Airport</h4>
    <% end %>
  </div>
</div>


<!-- modal-gallery is the modal dialog used for the image gallery -->
<div id="modal-gallery" class="modal modal-gallery hide fade">
    <div class="modal-header">
        <a class="close" data-dismiss="modal">&times;</a>
        <h3 class="modal-title"></h3>
    </div>
    <div class="modal-body"><div class="modal-image"></div></div>
    <div class="modal-footer">
        <a class="btn btn-primary modal-next">Next <i class="icon-arrow-right icon-white"></i></a>
        <a class="btn btn-info modal-prev"><i class="icon-arrow-left icon-white"></i> Previous</a>
        <a class="btn btn-success modal-play modal-slideshow" data-slideshow="5000"><i class="icon-play icon-white"></i> Slideshow</a>
        <a class="btn modal-download" target="_blank"><i class="icon-download"></i> Download</a>
    </div>
</div>